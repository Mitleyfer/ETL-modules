## Детализация интеграции PostgreSQL и Clickhouse

#### Общее описание

Интеграция осуществлена с помощью [движка PostgreSQL](https://clickhouse.com/docs/en/engines/table-engines/integrations/postgresql) для Clickhouse (создание
на кластере Clickhouse таблиц-ссылок на бд PostgreSQL). Для этого в бд PosgreSQL
создан пользователь с соответствующими правами - через него осуществляется запрос к 
PostgreSQL.

Для добавления новых таблиц из PostgreSQL в Clickhouse необходимо запустить скрипт
**run_ddl.py**, при этом в файле **config.yaml** должны быть указаны все необходимые
параметры - в том числе шаблоны исполняемых запросов к базам. В файле **ErrorDecorator.py**
нужно прописать путь для **config.yaml**.

Имена таблиц и колонок в Clickhouse соответствуют именам в PostgreSQL. Типы данных для
колонок приводятся к типам Clickhouse.

#### Описание процесса интеграции

На стороне PostgreSQL исполняется запрос к схеме базы данных - из него получаются
имена таблиц в бд. Такой же запрос исполняется на стороне Clickhouse - он так же
нужен для получения имен таблиц. Два множества имен сравниваются между собой
и из них выделяются имена таблиц, которые есть в PostgreSQL, но нет в Clickhouse.

Далее на стороне PostgeSQL производятся запросы к схеме каждой выделенной таблицы - 
оттуда берутся названия колонок и типы данных. Типы данных приводятся к типам
Clickhouse с помощью словаря в **config.yaml**. Далее колонки с новыми типами передаются
в тело шаблона DDL запроса и исполняются на стороне Clickhouse.

#### Зависимости

clickhouse-driver == 0.2.6

pandas == 2.1.4

psycopg2-bynary == 2.9.9

python == 3.10.13

pyyaml == 6.0.1
